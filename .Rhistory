list.files("./", pattern = "I.*fastq.gz")
fqs <- list.files("./", pattern = "I.*fastq.gz")
dereps <- list()
for (file in fqs){
dereps[[file]] <- derepFastq(file)
}
library(dada2)
library(phyloseq)
library(ggplot2)
fqs <- list.files("./", pattern = "I.*fastq.gz")
dereps <- list()
for (file in fqs){
dereps[[file]] <- derepFastq(file)
}
err8 <- readRDS("ITS_0008.R1.RDS")
err9 <- readRDS("ITS_0009.R1.RDS")
names(dereps)
if (substr(i,2,1)){}
for (i in names(dereps)){
if (substr(i,2,1)){}
}
i
substr(i,2,1)
substr(i,2,2)
for (i in names(dereps)){
if (substr(i,2,2)==8){
ddF[[i]] <- dada(derep = dereps[[i]], err = err8)
}else{
ddF[[i]] <- dada(derep = dereps[[i]], err = err9)
}
}
ddF <- list()
for (i in names(dereps)){
if (substr(i,2,2)==8){
ddF[[i]] <- dada(derep = dereps[[i]], err = err8)
}else{
ddF[[i]] <- dada(derep = dereps[[i]], err = err9)
}
}
top100seqs
dereps[[1]]
dereps[[1]]$uniques
dereps[[1]]$uniques[1:100]
dereps[[1]]$uniques[1:50]
for (i in dereps){
top50seqs <- c(top50seqs,dereps[[i]]$uniques[1:50])
}
top50seqs <- c()
for (i in dereps){
top50seqs <- c(top50seqs,dereps[[i]]$uniques[1:50])
}
dereps[[i]]$uniques[1:50]
dereps
i
for (i in dereps){
top50seqs <- c(top50seqs,i$uniques[1:50])
}
top50seqs
top50seqs
top50seqs <- c()
for (i in dereps){
top50seqs <- c(top50seqs,names(i$uniques[1:50]))
}
top50seqs
unique(top50seqs)
for (i in dereps){
top50seqs <- unique(c(top50seqs,names(i$uniques[1:50])))
}
length(top50seqs)
dereps[[i]]
names(dereps)
i <- names(dereps)[1]
dereps[[i]]$uniques[1:50]
unname(dereps[[i]]$uniques[1:50])
ddF[[i]]
i
names(dereps)
names(dereps) <- gsub("_.*","",names(dereps))
library(dada2)
library(phyloseq)
library(ggplot2)
fqs <- list.files("./", pattern = "I.*fastq.gz")
dereps <- list()
for (file in fqs){
dereps[[file]] <- derepFastq(file)
}
names(dereps) <- gsub("_.*","",names(dereps))
err8 <- readRDS("ITS_0008.R1.RDS")
err9 <- readRDS("ITS_0009.R1.RDS")
ddF <- list()
for (i in names(dereps)){
if (substr(i,2,2)==8){
ddF[[i]] <- dada(derep = dereps[[i]], err = err8)
}else{
ddF[[i]] <- dada(derep = dereps[[i]], err = err9)
}
}
top50seqs <- c()
for (i in dereps){
top50seqs <- unique(c(top50seqs,names(i$uniques[1:50])))
}
length(top50seqs) #track a total og 131 sequences
i <- names(dereps)[1]
i
data.frame(sequence=names(dereps[[i]]$uniques[1:topx]),
Abundance=unname(dereps[[i]]$uniques[1:topx]),
ASV=ddF[[i]]$sequence[ddF[[i]]$map[1:topx]]
i)
ddF[[i]]$sequence
ddF[[i]]$map[1:topx]
topx=50
ddF[[i]]$map[1:topx]
data.frame(sequence=names(dereps[[i]]$uniques[1:topx]),
Abundance=unname(dereps[[i]]$uniques[1:topx]),
ASV=ddF[[i]]$sequence[ddF[[i]]$map[1:topx]]
i)
names(dereps[[i]]$uniques[1:topx])
unname(dereps[[i]]$uniques[1:topx])
data.frame(sequence=names(dereps[[i]]$uniques[1:topx]),
Abundance=unname(dereps[[i]]$uniques[1:topx]),
ASV=ddF[[i]]$sequence[ddF[[i]]$map[1:topx]],
i)
data.frame(sequence=names(dereps[[i]]$uniques[1:topx]),
Abundance=unname(dereps[[i]]$uniques[1:topx]),
ASV=ddF[[i]]$sequence[ddF[[i]]$map[1:topx]],
SampleID=i)
topx=20
topxseqs <- c()
for (i in dereps){
topxseqs <- unique(c(topxseqs,names(i$uniques[1:topx])))
}
length(topxseqs) #track a total og 131 sequences
topxseqs <- c(topxseqs,names(i$uniques[1:topx]))
table(topxseqs)
topx=20
topxseqs <- c()
for (i in dereps){
topxseqs <- c(topxseqs,names(i$uniques[1:topx]))
}
table(topxseqs)
table(table(topxseqs))
length(unique(topxseqs)) # track a total of 54 sequences
table(table(topxseqs))
i <- names(dereps)[1]
df <- data.frame()
df <- rbind(df, data.frame(sequence=names(dereps[[i]]$uniques[1:topx]),
Abundance=unname(dereps[[i]]$uniques[1:topx]),
ASV=ddF[[i]]$sequence[ddF[[i]]$map[1:topx]],
SampleID=i))
df
for(i in names(dereps)){
df <- rbind(df, data.frame(sequence=names(dereps[[i]]$uniques[1:topx]),
Abundance=unname(dereps[[i]]$uniques[1:topx]),
ASV=ddF[[i]]$sequence[ddF[[i]]$map[1:topx]],
SampleID=i))
}
df <- data.frame()
for(i in names(dereps)){
df <- rbind(df, data.frame(sequence=names(dereps[[i]]$uniques[1:topx]),
Abundance=unname(dereps[[i]]$uniques[1:topx]),
ASV=ddF[[i]]$sequence[ddF[[i]]$map[1:topx]],
SampleID=i))
}
df
df$ASV
df$ASV2 <- df$ASV
length(levels(df$ASV2))
levels(df$ASV2) <- paste0("ASV-",1:length(levels(df$ASV2)))
levels(df$ASV2)
df$sequence2 <- df$sequence
levels(df$sequence2) <- paste0("ASV-",1:length(levels(df$sequence2)))
ggplot(df3, aes(x = sequence2, y = Abundance, fill=ASV)) +
geom_bar(stat="identity") +
facet_grid(SampleID ~ .) +
theme(axis.text.x = element_text(angle=90, hjust=1))
ggplot(df, aes(x = sequence2, y = Abundance, fill=ASV)) +
geom_bar(stat="identity") +
facet_grid(SampleID ~ .) +
theme(axis.text.x = element_text(angle=90, hjust=1))
ggplot(df, aes(x = sequence2, y = Abundance, fill=ASV)) +
geom_bar(stat="identity") +
facet_grid(SampleID ~ ., scale="free_y") +
theme(axis.text.x = element_text(angle=90, hjust=1))
ggplot(df, aes(x = sequence2, y = Abundance, fill=ASV2)) +
geom_bar(stat="identity") +
facet_grid(SampleID ~ ., scale="free_y") +
theme(axis.text.x = element_text(angle=90, hjust=1))
topx=10
topxseqs <- c()
for (i in dereps){
topxseqs <- c(topxseqs,names(i$uniques[1:topx]))
}
length(unique(topxseqs)) # track a total of 54 sequences
table(table(topxseqs)) # 10 sequences are in the top20 in all samples
for(i in names(dereps)){
df <- rbind(df, data.frame(sequence=names(dereps[[i]]$uniques[1:topx]),
Abundance=unname(dereps[[i]]$uniques[1:topx]),
ASV=ddF[[i]]$sequence[ddF[[i]]$map[1:topx]],
SampleID=i))
}
df <- data.frame()
df$ASV2 <- df$ASV
levels(df$ASV2) <- paste0("ASV-",1:length(levels(df$ASV2)))
df$sequence2 <- df$sequence
levels(df$sequence2) <- paste0("ASV-",1:length(levels(df$sequence2)))
ggplot(df, aes(x = sequence2, y = Abundance, fill=ASV2)) +
geom_bar(stat="identity") +
facet_grid(SampleID ~ ., scale="free_y") +
theme(axis.text.x = element_text(angle=90, hjust=1))
topx=10
topxseqs <- c()
for (i in dereps){
topxseqs <- c(topxseqs,names(i$uniques[1:topx]))
}
length(unique(topxseqs)) # track a total of 54 sequences
table(table(topxseqs)) # 10 sequences are in the top20 in all samples
table(table(topxseqs)) #6 sequences are in the top10 in all samples
df <- data.frame()
for(i in names(dereps)){
df <- rbind(df, data.frame(sequence=names(dereps[[i]]$uniques[1:topx]),
Abundance=unname(dereps[[i]]$uniques[1:topx]),
ASV=ddF[[i]]$sequence[ddF[[i]]$map[1:topx]],
SampleID=i))
}
df$ASV2 <- df$ASV
levels(df$ASV2) <- paste0("ASV-",1:length(levels(df$ASV2)))
df$sequence2 <- df$sequence
levels(df$sequence2) <- paste0("ASV-",1:length(levels(df$sequence2)))
ggplot(df, aes(x = sequence2, y = Abundance, fill=ASV2)) +
geom_bar(stat="identity") +
facet_grid(SampleID ~ ., scale="free_y") +
theme(axis.text.x = element_text(angle=90, hjust=1))
priors <- unique(topxseqs)
for (i in names(dereps)){
if (substr(i,2,2)==8){
ddF2[[i]] <- dada(derep = dereps[[i]], err = err8, priors = priors)
}else{
ddF2[[i]] <- dada(derep = dereps[[i]], err = err9, priors = priors)
}
}
priors <- unique(topxseqs)
ddF2 <- list()
for (i in names(dereps)){
if (substr(i,2,2)==8){
ddF2[[i]] <- dada(derep = dereps[[i]], err = err8, priors = priors)
}else{
ddF2[[i]] <- dada(derep = dereps[[i]], err = err9, priors = priors)
}
}
df2 <- data.frame()
df2 <- rbind(df, data.frame(sequence=names(dereps[[i]]$uniques[1:topx]),
Abundance=unname(dereps[[i]]$uniques[1:topx]),
ASV=ddF2[[i]]$sequence[ddF2[[i]]$map[1:topx]],
SampleID=i))
df2 <- data.frame()
for(i in names(dereps)){
df2 <- rbind(df, data.frame(sequence=names(dereps[[i]]$uniques[1:topx]),
Abundance=unname(dereps[[i]]$uniques[1:topx]),
ASV=ddF2[[i]]$sequence[ddF2[[i]]$map[1:topx]],
SampleID=i))
}
topx
df2 <- data.frame()
for(i in names(dereps)){
df2 <- rbind(df2, data.frame(sequence=names(dereps[[i]]$uniques[1:topx]),
Abundance=unname(dereps[[i]]$uniques[1:topx]),
ASV=ddF2[[i]]$sequence[ddF2[[i]]$map[1:topx]],
SampleID=i))
}
df2$ASV2 <- df2$ASV
levels(df2$ASV2) <- paste0("ASV-",1:length(levels(df2$ASV2)))
df2$sequence2 <- df2$sequence
levels(df2$sequence2) <- paste0("ASV-",1:length(levels(df2$sequence2)))
ggplot(df2, aes(x = sequence2, y = Abundance, fill=ASV2)) +
geom_bar(stat="identity") +
facet_grid(SampleID ~ ., scale="free_y") +
theme(axis.text.x = element_text(angle=90, hjust=1))
levels(df2$sequence2) <- paste0("sequence-",1:length(levels(df2$sequence2)))
df$sequence==df2$ASV
df2$sequence==df2$ASV
df2$sequence==df2$ASV
df2$sequence
df2$ASV
df2$sequence==df2$ASV
as.character(df2$sequence)==as.character(df2$ASV)
df2$ASVrep <- as.character(df2$sequence)==as.character(df2$ASV)
ggplot(df2, aes(x = sequence2, y = Abundance, fill=ASVrep)) +
geom_bar(stat="identity") +
facet_grid(SampleID ~ ., scale="free_y") +
theme(axis.text.x = element_text(angle=90, hjust=1))
df2$ASVrep2[df2$ASVrep] <- df2$ASV2[df2$ASVrep]
ggplot(df2, aes(x = sequence2, y = Abundance, fill=ASVrep2)) +
geom_bar(stat="identity") +
facet_grid(SampleID ~ ., scale="free_y") +
theme(axis.text.x = element_text(angle=90, hjust=1))
df2$ASVrep2
df2$ASV2[df2$ASVrep]
df2$ASVrep <- as.character(df2$sequence)==as.character(df2$ASV)
df2$ASVrep2[df2$ASVrep] <- as.character(df2$ASV2[df2$ASVrep])
ggplot(df2, aes(x = sequence2, y = Abundance, fill=ASVrep2)) +
geom_bar(stat="identity") +
facet_grid(SampleID ~ ., scale="free_y") +
theme(axis.text.x = element_text(angle=90, hjust=1))
df$ASV2 <- df$ASV
levels(df$ASV2) <- paste0("ASV-",1:length(levels(df$ASV2)))
df$sequence2 <- df$sequence
df$ASVrep <- as.character(df$sequence)==as.character(df$ASV)
df$ASVrep2[df$ASVrep] <- as.character(df$ASV2[df$ASVrep])
levels(df$sequence2) <- paste0("sequence-",1:length(levels(df$sequence2)))
ggplot(df, aes(x = sequence2, y = Abundance, fill=ASV2)) +
geom_bar(stat="identity") +
facet_grid(SampleID ~ ., scale="free_y") +
theme(axis.text.x = element_text(angle=90, hjust=1))
ggplot(df2, aes(x = sequence2, y = Abundance, fill=ASV2)) +
geom_bar(stat="identity") +
facet_grid(SampleID ~ ., scale="free_y") +
theme(axis.text.x = element_text(angle=90, hjust=1))
df2$sequence2
df2$sequence2=="sequence-4"
df2$sequence[df2$sequence2=="sequence-4"]
unique(df2$sequence[df2$sequence2=="sequence-4"])
df2$sequence[df2$sequence2=="sequence-4"][1]
as.character(df2$sequence[df2$sequence2=="sequence-4"][1])
priors <- as.character(df2$sequence[df2$sequence2=="sequence-4"][1])
ddF3 <- list()
for (i in names(dereps)){
if (substr(i,2,2)==8){
ddF3[[i]] <- dada(derep = dereps[[i]], err = err8, priors = priors)
}else{
ddF3[[i]] <- dada(derep = dereps[[i]], err = err9, priors = priors)
}
}
df2 <- data.frame()
for(i in names(dereps)){
df2 <- rbind(df2, data.frame(sequence=names(dereps[[i]]$uniques[1:topx]),
Abundance=unname(dereps[[i]]$uniques[1:topx]),
ASV=ddF3[[i]]$sequence[ddF3[[i]]$map[1:topx]],
SampleID=i))
}
df2$ASV2 <- df2$ASV
levels(df2$ASV2) <- paste0("ASV-",1:length(levels(df2$ASV2)))
df2$sequence2 <- df2$sequence
levels(df2$sequence2) <- paste0("sequence-",1:length(levels(df2$sequence2)))
df2$ASVrep <- as.character(df2$sequence)==as.character(df2$ASV)
df2$ASVrep2[df2$ASVrep] <- as.character(df2$ASV2[df2$ASVrep])
ggplot(df2, aes(x = sequence2, y = Abundance, fill=ASVrep2)) +
geom_bar(stat="identity") +
facet_grid(SampleID ~ ., scale="free_y") +
theme(axis.text.x = element_text(angle=90, hjust=1))
ggplot(df3, aes(x = sequence2, y = Abundance, fill=ASV2)) +
geom_bar(stat="identity") +
facet_grid(SampleID ~ ., scale="free_y") +
theme(axis.text.x = element_text(angle=90, hjust=1))
df3$ASV2 <- df3$ASV
levels(df3$ASV2) <- paste0("ASV-",1:length(levels(df3$ASV2)))
df3$sequence2 <- df3$sequence
levels(df3$sequence2) <- paste0("sequence-",1:length(levels(df3$sequence2)))
df3$ASVrep2[df3$ASVrep] <- as.character(df3$ASV2[df3$ASVrep])
df3$ASVrep <- as.character(df3$sequence)==as.character(df3$ASV)
for(i in names(dereps)){
df3 <- rbind(df3, data.frame(sequence=names(dereps[[i]]$uniques[1:topx]),
Abundance=unname(dereps[[i]]$uniques[1:topx]),
ASV=ddF3[[i]]$sequence[ddF3[[i]]$map[1:topx]],
SampleID=i))
}
df3 <- data.frame()
for(i in names(dereps)){
df3 <- rbind(df3, data.frame(sequence=names(dereps[[i]]$uniques[1:topx]),
Abundance=unname(dereps[[i]]$uniques[1:topx]),
ASV=ddF3[[i]]$sequence[ddF3[[i]]$map[1:topx]],
SampleID=i))
}
df3$ASV2 <- df3$ASV
levels(df3$ASV2) <- paste0("ASV-",1:length(levels(df3$ASV2)))
df3$sequence2 <- df3$sequence
df3$ASVrep <- as.character(df3$sequence)==as.character(df3$ASV)
df3$ASVrep2[df3$ASVrep] <- as.character(df3$ASV2[df3$ASVrep])
ggplot(df3, aes(x = sequence2, y = Abundance, fill=ASV2)) +
geom_bar(stat="identity") +
facet_grid(SampleID ~ ., scale="free_y") +
theme(axis.text.x = element_text(angle=90, hjust=1))
levels(df3$sequence2) <- paste0("sequence-",1:length(levels(df3$sequence2)))
ggplot(df3, aes(x = sequence2, y = Abundance, fill=ASVrep2)) +
geom_bar(stat="identity") +
facet_grid(SampleID ~ ., scale="free_y") +
theme(axis.text.x = element_text(angle=90, hjust=1))
ggplot(df3, aes(x = sequence2, y = Abundance, fill=ASVrep)) +
geom_bar(stat="identity") +
facet_grid(SampleID ~ ., scale="free_y") +
theme(axis.text.x = element_text(angle=90, hjust=1))
ggplot(df3, aes(x = sequence2, y = Abundance, fill=ASVrep)) +
geom_bar(stat="identity") +
facet_grid(SampleID ~ ., scale="free_y") +
theme(axis.text.x = element_text(angle=90, hjust=1))
levels(df3$sequence)
levels(df3$sequence)[1:7]
levels(df3$sequence)[1:7]
levels(df3$sequence)[1:7,13]
levels(df3$sequence)[c(1:7,13)]
ggplot(df3, aes(x = sequence2, y = Abundance, fill=ASVrep2)) +
geom_bar(stat="identity") +
facet_grid(SampleID ~ ., scale="free_y") +
theme(axis.text.x = element_text(angle=90, hjust=1))
library(dada2);packageVersion(dada2)
library(dada2);packageVersion("dada2")
library(dada2);packageVersion("dada2")
library(phyloseq);packageVersion("phyloseq")
library(ggplot2);packageVersion("ggplot2")
